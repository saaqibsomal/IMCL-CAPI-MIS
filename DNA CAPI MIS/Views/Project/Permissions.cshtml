@model DNA_CAPI_MIS.Models.Project

@{
    ViewBag.Title = "Project Permissions";
}

@Styles.Render("~/Content/styles/filters")

@section Scripts {
@Scripts.Render("~/bundles/bootstrap/jqwidgets")
@Scripts.Render("~/bundles/bootstrap/filters")

<script>
    $(document).ready(function () {
        @foreach (var r in ViewBag.Roles)
        { 
            WriteLiteral("$(\"#role_"+r.Id+"\").select2();");
        }
    });

</script>
}

<p>
    @Html.ActionLink("All Projects", "OpenProject", "Designer") |
    @Html.ActionLink("Project Overview", "ProjectOverview", "Designer", new { id = Model.ID }, null)
</p>
<h4><strong>@Model.Name</strong></h4>
<h4>@ViewBag.Title</h4>

@if (ViewBag.ErrorMessage != null && ViewBag.ErrorMessage.Length > 0)
{
    <h4>@ViewBag.ErrorMessage</h4>
}
else
{
    using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()

        foreach (var r in ViewBag.Roles)
        {
        <div class="form-horizontal">
            <div class="form-group">
                <h6><label class="control-label col-md-2">@r.Title</label></h6>
                <div class="col-md-8">
                    <select id="role_@r.Id" name="role_@r.Id" multiple="multiple" style="width:100%;height:26px;">
                        @foreach (var u in ViewBag.ProjectUsers)
                        {
                            var isSelected = (u.IsSelected > 0) ? "selected" : "";
                            if (u.RoleId == r.Id)
                            {
                                <option @isSelected value="@u.UserId">@u.UserName</option>
                            }
                        }
                    </select>
                </div>
            </div>

        </div>
        <br/><br/>
        }
        <div class="form-group">
            <div class="col-md-offset-2 col-md-8">
                <input type="submit" value="Save Permissions" class="btn btn-default" />
                <input id="ProjectID" name="ProjectID" type="hidden" value="@Model.ID" />
           </div>
        </div>
    }
}